"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[134],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var r=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,s=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=u(n),d=s,h=m["".concat(l,".").concat(d)]||m[d]||p[d]||o;return n?r.createElement(h,a(a({ref:t},c),{},{components:n})):r.createElement(h,a({ref:t},c))}));function d(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var o=n.length,a=new Array(o);a[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:s,a[1]=i;for(var u=2;u<o;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7818:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return i},metadata:function(){return u},toc:function(){return p}});var r=n(3117),s=n(102),o=(n(7294),n(3905)),a=["components"],i={sidebar_position:1,title:"Install eBPF Sensor on Kubernetes | Levo.ai Documentation"},l="Sensor on Kubernetes",u={unversionedId:"install-traffic-capture-sensors/ebpf-sensor/sensor-kubernetes",id:"install-traffic-capture-sensors/ebpf-sensor/sensor-kubernetes",title:"Install eBPF Sensor on Kubernetes | Levo.ai Documentation",description:"Install on Kubernetes",source:"@site/docs/install-traffic-capture-sensors/ebpf-sensor/sensor-kubernetes.md",sourceDirName:"install-traffic-capture-sensors/ebpf-sensor",slug:"/install-traffic-capture-sensors/ebpf-sensor/sensor-kubernetes",permalink:"/install-traffic-capture-sensors/ebpf-sensor/sensor-kubernetes",draft:!1,editUrl:"https://github.com/levoai/docs/edit/main/docs/install-traffic-capture-sensors/ebpf-sensor/sensor-kubernetes.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Install eBPF Sensor on Kubernetes | Levo.ai Documentation"},sidebar:"tutorialSidebar",previous:{title:"Install eBPF Sensor",permalink:"/install-traffic-capture-sensors/ebpf-sensor/"},next:{title:"Sensor on AWS ECS using Terraform",permalink:"/install-traffic-capture-sensors/ebpf-sensor/sensor-aws-ecs-terraform"}},c={},p=[{value:"Install on Kubernetes",id:"install-on-kubernetes",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"1. Add levoai Helm repo",id:"1-add-levoai-helm-repo",level:3},{value:"2. Create <code>levoai</code> namespace &amp; install Sensor",id:"2-create-levoai-namespace--install-sensor",level:3},{value:"3. Verify connectivity with Satellite",id:"3-verify-connectivity-with-satellite",level:3},{value:"i. Check Sensor health",id:"i-check-sensor-health",level:4},{value:"ii. Check connectivity",id:"ii-check-connectivity",level:4},{value:"NOTE:",id:"note",level:4},{value:"Using a Private Docker Registry for Kubernetes Installations (Optional)",id:"using-a-private-docker-registry-for-kubernetes-installations-optional",level:3},{value:"Optimizing Resource Usage for Levo eBPF Sensor",id:"optimizing-resource-usage-for-levo-ebpf-sensor",level:3},{value:"1. Configure CPU and Memory Requests/Limits",id:"1-configure-cpu-and-memory-requestslimits",level:4},{value:"2. Set Resource Values via Helm",id:"2-set-resource-values-via-helm",level:4},{value:"3. Verify Resource Settings",id:"3-verify-resource-settings",level:4},{value:"4. Tips for Tuning",id:"4-tips-for-tuning",level:4}],m={toc:p};function d(e){var t=e.components,n=(0,s.Z)(e,a);return(0,o.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"sensor-on-kubernetes"},"Sensor on Kubernetes"),(0,o.kt)("h2",{id:"install-on-kubernetes"},"Install on Kubernetes"),(0,o.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Kubernetes version >= v1.18.0"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://helm.sh/docs/intro/install/"},"Helm v3")," installed and working."),(0,o.kt)("li",{parentName:"ul"},"The Kubernetes cluster API endpoint should be reachable from the machine you are running Helm."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"kubectl")," access to the cluster, with ",(0,o.kt)("inlineCode",{parentName:"li"},"cluster-admin")," permissions.")),(0,o.kt)("h3",{id:"1-add-levoai-helm-repo"},"1. Add levoai Helm repo"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"helm repo add levoai https://charts.levo.ai && helm repo update levoai\n")),(0,o.kt)("h3",{id:"2-create-levoai-namespace--install-sensor"},"2. Create ",(0,o.kt)("inlineCode",{parentName:"h3"},"levoai")," namespace & install Sensor"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Replace 'hostname|IP' & 'port' with the values you noted down from the Satellite install\n# If Sensor is installed on same cluster as Satellite, use 'levoai-haproxy'\n# If they are installed on different clusters, the haproxy service should be exposed so that it is\n# reachable by the sensor. Use the exposed address as the value for satellite-url.\n# Also specify the Organization ID (copy from levo platform).\n#\nhelm upgrade levoai-sensor levoai/levoai-ebpf-sensor \\\n  --install \\\n  --namespace levoai \\\n  --create-namespace \\\n  --set sensor.orgId=<your-org-id>\n  --set sensor.satelliteUrl=levoai-haproxy \\\n  --set sensor.levoEnv=<Application environment>\n")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"You need to expose the levoai-haproxy service so that sensor can reach satellite when it is installed\nin a different cluster; the installation command will be:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"helm upgrade levoai-sensor levoai/levoai-ebpf-sensor \\\n  --install \\\n  --namespace levoai \\\n  --create-namespace \\\n  --set sensor.satelliteUrl=<hostname|IP:port> \\\n  --set sensor.levoEnv=<Application environment>\n"))),(0,o.kt)("h3",{id:"3-verify-connectivity-with-satellite"},"3. Verify connectivity with Satellite"),(0,o.kt)("h4",{id:"i-check-sensor-health"},"i. Check Sensor health"),(0,o.kt)("p",null,"Check the health of the Sensor by executing the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl -n levoai get pods | grep levoai-sensor\n")),(0,o.kt)("p",null,"If the Sensor is healthy, you should see output similar to below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"levoai-sensor-747fb4aaa9-gv8g9   1/1     Running   0             1m8s\n")),(0,o.kt)("h4",{id:"ii-check-connectivity"},"ii. Check connectivity"),(0,o.kt)("p",null,"Execute the following command to check for connectivity health:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'# Please specify the actual pod name for levoai-sensor below\nkubectl -n levoai logs <levoai-sensor pod name> | grep "Initial connection with Collector"\n')),(0,o.kt)("p",null,"If connectivity is healthy, you should see output similar to below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"2022/06/13 21:15:40 729071  INFO [ebpf_sensor.cpp->main:120]    Initial connection with Collector was successful.\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Please contact ",(0,o.kt)("a",{parentName:"strong",href:"mailto:support@levo.ai"},"Support")," if you notice health/connectivity related errors.")),(0,o.kt)("h4",{id:"note"},"NOTE:"),(0,o.kt)("p",null,"The default address for the satellite url in helm installations is ",(0,o.kt)("inlineCode",{parentName:"p"},"levoai-haproxy"),".\nThis address assumes that the Satellite is installed in the same cluster (and namespace) as the Sensor.\nIf they are installed on different clusters, the haproxy service should be exposed so that it is\nreachable by the sensor. Use the exposed address as the value for satellite-url.\nIf you wish to, you may also request Levo to host the Satellite for you. In this case, you will need to set the\n",(0,o.kt)("inlineCode",{parentName:"p"},"satellite-url")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"https://collector.levo.ai")," and specify an organization ID (",(0,o.kt)("inlineCode",{parentName:"p"},"organization-id"),") via helm values."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"helm upgrade --set sensor.levoEnv=<your-application-environment> --set sensor.satelliteUrl=https://collector.levo.ai --set sensor.orgId=<your-org-id> levoai-sensor levoai/levoai-ebpf-sensor -n levoai\n")),(0,o.kt)("p",null,"Please proceed to the next step, if there are no errors."),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"using-a-private-docker-registry-for-kubernetes-installations-optional"},"Using a Private Docker Registry for Kubernetes Installations (Optional)"),(0,o.kt)("p",null,"If you want to use a private docker registry for the sensor installation, refer to ",(0,o.kt)("a",{parentName:"p",href:"/guides/general/private-registry"},"Using a Private Docker Registry for Kubernetes Installations"),"."),(0,o.kt)("h3",{id:"optimizing-resource-usage-for-levo-ebpf-sensor"},"Optimizing Resource Usage for Levo eBPF Sensor"),(0,o.kt)("p",null,"Resource requests and limits help ensure the Sensor runs efficiently and reliably in your Kubernetes cluster. You can tune these settings to match your environment\u2019s needs and available resources."),(0,o.kt)("h4",{id:"1-configure-cpu-and-memory-requestslimits"},"1. Configure CPU and Memory Requests/Limits"),(0,o.kt)("p",null,"The Sensor\u2019s resource settings are defined in the Helm chart under ",(0,o.kt)("inlineCode",{parentName:"p"},"sensor.containerResources"),". You can override these values during installation or upgrade:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Requests"),": Minimum resources guaranteed for the container."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Limits"),": Maximum resources the container can use.")),(0,o.kt)("p",null,"Example values.yaml section:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"sensor:\n  containerResources:\n    requests:\n      cpu: 0.5\n      memory: 1Gi\n    limits:\n      cpu: 1.0\n      memory: 2Gi\n")),(0,o.kt)("h4",{id:"2-set-resource-values-via-helm"},"2. Set Resource Values via Helm"),(0,o.kt)("p",null,"To customize resource allocation, use the following flags with your Helm command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"helm upgrade --install -n levoai levoai-sensor levoai/levoai-ebpf-sensor \\\n  --set sensor.containerResources.requests.cpu=0.25 \\\n  --set sensor.containerResources.limits.cpu=0.5 \\\n  --set sensor.containerResources.requests.memory=512Mi \\\n  --set sensor.containerResources.limits.memory=1Gi\n")),(0,o.kt)("p",null,"You can adjust the values (",(0,o.kt)("inlineCode",{parentName:"p"},"cpu"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"memory"),") to fit your cluster\u2019s capacity and workload."),(0,o.kt)("h4",{id:"3-verify-resource-settings"},"3. Verify Resource Settings"),(0,o.kt)("p",null,"After deployment, check the resource settings applied to the Sensor pod:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl -n levoai get pod <levoai-sensor-pod-name> -o jsonpath='{.spec.containers[*].resources}'\n")),(0,o.kt)("h4",{id:"4-tips-for-tuning"},"4. Tips for Tuning"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Monitor Usage"),": Use ",(0,o.kt)("inlineCode",{parentName:"li"},"kubectl top pod")," or your cluster\u2019s monitoring tools to observe actual resource consumption."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Adjust Gradually"),": Start with conservative values and increase if you notice throttling or OOM (Out Of Memory) errors."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Cluster Constraints"),": Ensure your node types and quotas can support the requested resources.")),(0,o.kt)("p",null,"For further assistance with resource optimization, contact ",(0,o.kt)("a",{parentName:"p",href:"mailto:support@levo.ai"},"Support"),"."))}d.isMDXComponent=!0}}]);