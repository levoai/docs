"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5979],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),g=u(n),d=r,f=g["".concat(l,".").concat(d)]||g[d]||p[d]||o;return n?a.createElement(f,i(i({ref:t},c),{},{components:n})):a.createElement(f,i({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var u=2;u<o;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},4524:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return p}});var a=n(3117),r=n(102),o=(n(7294),n(3905)),i=["components"],s={sidebar_position:6},l="AWS API Gateway",u={unversionedId:"install-traffic-capture-sensors/aws-api-gateway",id:"install-traffic-capture-sensors/aws-api-gateway",title:"AWS API Gateway",description:"Logs-based Instrumentation",source:"@site/docs/install-traffic-capture-sensors/aws-api-gateway.md",sourceDirName:"install-traffic-capture-sensors",slug:"/install-traffic-capture-sensors/aws-api-gateway",permalink:"/install-traffic-capture-sensors/aws-api-gateway",draft:!1,editUrl:"https://github.com/levoai/docs/edit/main/docs/install-traffic-capture-sensors/aws-api-gateway.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"AWS Traffic Mirroring",permalink:"/install-traffic-capture-sensors/aws-traffic-mirroring"},next:{title:"Azure API Management",permalink:"/install-traffic-capture-sensors/azure-api-management"}},c={},p=[{value:"Logs-based Instrumentation",id:"logs-based-instrumentation",level:2},{value:"Tailing Logs with CloudWatch",id:"tailing-logs-with-cloudwatch",level:3},{value:"Streaming Logs with CloudWatch and Amazon Data Firehose",id:"streaming-logs-with-cloudwatch-and-amazon-data-firehose",level:3},{value:"CloudFront Lambda@Edge Instrumentation",id:"cloudfront-lambdaedge-instrumentation",level:2}],g={toc:p};function d(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"aws-api-gateway"},"AWS API Gateway"),(0,o.kt)("h2",{id:"logs-based-instrumentation"},"Logs-based Instrumentation"),(0,o.kt)("h3",{id:"tailing-logs-with-cloudwatch"},"Tailing Logs with CloudWatch"),(0,o.kt)("p",null,"You may use CloudWatch Logs to instrument your AWS API Gateway endpoints."),(0,o.kt)("p",null,"The following script has been provided as an example to help you configure logging for your API Gateway endpoints."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/install-log-parsing-sensors"},"Levo's Log Parser")," can be configured to parse the logs and send them to Levo."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'#!/usr/bin/env bash\n\nlog_group_name=levo/api-gateway-logs\n\naws logs create-log-group --log-group-name $log_group_name\naws logs put-retention-policy --log-group-name $log_group_name --retention-in-days 7\n\nlog_group_arn=$(aws logs describe-log-groups --log-group-name-prefix $log_group_name --query \'logGroups[0].arn\' --output text)\n\naws apigatewayv2 update-stage --api-id \'your-apigateway-api-id\' --stage-name \'$default\' --access-log-settings "DestinationArn=$log_group_arn,"\'Format="{\\"host\\":\\"$context.domainName\\",\\"method\\":\\"$context.httpMethod\\",\\"path\\":\\"$context.path\\",\\"agent\\":\\"$context.identity.userAgent\\",\\"code\\":\\"$context.status\\",\\"requestId\\":\\"$context.requestId\\",\\"ip\\":\\"$context.identity.sourceIp\\",\\"requestTime\\":\\"$context.requestTime\\",\\"routeKey\\":\\"$context.routeKey\\",\\"protocol\\":\\"$context.protocol\\",\\"responseLength\\":\\"$context.responseLength\\"}"\'\n\naws logs tail --follow $log_group_name\n')),(0,o.kt)("h3",{id:"streaming-logs-with-cloudwatch-and-amazon-data-firehose"},"Streaming Logs with CloudWatch and Amazon Data Firehose"),(0,o.kt)("p",null,"You may also use Amazon Data Firehose to stream live access logs to Levo's satellite."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Configure a CloudWatch log group for APIs in API Gateway (using the above example script)"),(0,o.kt)("li",{parentName:"ol"},"Create a Firehose stream to send incoming events to a publicly accessible satellite endpoint"),(0,o.kt)("li",{parentName:"ol"},"Connect the CloudWatch log group to the Firehose stream")),(0,o.kt)("p",null,"Please contact ",(0,o.kt)("inlineCode",{parentName:"p"},"support@levo.ai")," if you are interested in this setup."),(0,o.kt)("h2",{id:"cloudfront-lambdaedge-instrumentation"},"CloudFront Lambda@Edge Instrumentation"),(0,o.kt)("p",null,"You may configure AWS CloudFront with your API Gateway endpoints as the origin, and use Lambda@Edge functions to intercept and capture traffic."),(0,o.kt)("p",null,"Please visit the following links for more information"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://repost.aws/knowledge-center/api-gateway-cloudfront-distribution"},"Setting up API Gateway with a CloudFront distribution")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/install-traffic-capture-sensors/aws-cloudfront"},"Setting up Levo's CloudFront Lambda@Edge Functions"))))}d.isMDXComponent=!0}}]);