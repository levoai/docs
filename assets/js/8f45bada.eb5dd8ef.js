"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5608],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var r=a.createContext({}),c=function(e){var t=a.useContext(r),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(r.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,i=e.originalType,r=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(n),h=l,m=d["".concat(r,".").concat(h)]||d[h]||p[h]||i;return n?a.createElement(m,o(o({ref:t},u),{},{components:n})):a.createElement(m,o({ref:t},u))}));function h(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var r in t)hasOwnProperty.call(t,r)&&(s[r]=t[r]);s.originalType=e,s.mdxType="string"==typeof e?e:l,o[1]=s;for(var c=2;c<i;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1262:function(e,t,n){n.d(t,{Z:function(){return i}});var a=n(7294),l=n(2389);function i(e){var t=e.children,n=e.fallback;return(0,l.Z)()?a.createElement(a.Fragment,null,null==t?void 0:t()):null!=n?n:null}},1771:function(e,t,n){n.r(t),n.d(t,{DownloadDockerComposeLink:function(){return h},assets:function(){return p},contentTitle:function(){return c},default:function(){return f},frontMatter:function(){return r},metadata:function(){return u},toc:function(){return d}});var a=n(3117),l=n(102),i=(n(7294),n(3905)),o=n(1262),s=["components"],r={sidebar_position:3},c="Install Satellite",u={unversionedId:"api-observability/install-guide/install-satellite",id:"api-observability/install-guide/install-satellite",title:"Install Satellite",description:"1. Prerequisites",source:"@site/docs/api-observability/install-guide/install-satellite.mdx",sourceDirName:"api-observability/install-guide",slug:"/api-observability/install-guide/install-satellite",permalink:"/api-observability/install-guide/install-satellite",draft:!1,editUrl:"https://github.com/levoai/docs/edit/main/docs/api-observability/install-guide/install-satellite.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Compatibility Check",permalink:"/api-observability/install-guide/os-compat-check"},next:{title:"Install Sensor",permalink:"/api-observability/install-guide/install-sensor/"}},p={},d=[{value:"1. Prerequisites",id:"1-prerequisites",level:2},{value:"2. Copy <code>Authorization Key</code> from Levo.ai",id:"2-copy-authorization-key-from-levoai",level:2},{value:"3. Follow instructions for your platform",id:"3-follow-instructions-for-your-platform",level:2},{value:"Install on Kubernetes",id:"install-on-kubernetes",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"1. Setup environment variables",id:"1-setup-environment-variables",level:3},{value:"2. Install levoai Helm repo",id:"2-install-levoai-helm-repo",level:3},{value:"3. Create <code>levoai</code> namespace &amp; install Satellite",id:"3-create-levoai-namespace--install-satellite",level:3},{value:"If locating Satellite on the same cluster alongside Sensor",id:"if-locating-satellite-on-the-same-cluster-alongside-sensor",level:4},{value:"If locating Satellite on a dedicated cluster",id:"if-locating-satellite-on-a-dedicated-cluster",level:4},{value:"4. Verify connectivity with Levo.ai",id:"4-verify-connectivity-with-levoai",level:3},{value:"a. Check Satellite health",id:"a-check-satellite-health",level:4},{value:"b. Check connectivity",id:"b-check-connectivity",level:4},{value:"5. Note down <code>Host:Port</code> information",id:"5-note-down-hostport-information",level:3},{value:"If locating Satellite on the same cluster alongside Sensor",id:"if-locating-satellite-on-the-same-cluster-alongside-sensor-1",level:4},{value:"If locating Satellite on a dedicated cluster",id:"if-locating-satellite-on-a-dedicated-cluster-1",level:4},{value:"Install on Linux host via Docker Compose",id:"install-on-linux-host-via-docker-compose",level:2},{value:"Prerequisites",id:"prerequisites-1",level:3},{value:"1. Download Docker Compose file",id:"1-download-docker-compose-file",level:3},{value:"2. Install Satellite",id:"2-install-satellite",level:3},{value:"3. Verify connectivity with Levo.ai",id:"3-verify-connectivity-with-levoai",level:3},{value:"a. Check Satellite health",id:"a-check-satellite-health-1",level:4},{value:"b. Check connectivity",id:"b-check-connectivity-1",level:4},{value:"4. Note down <code>Host:Port</code> information",id:"4-note-down-hostport-information",level:3},{value:"Install in AWS EC2 using Levo Satellite AMI",id:"install-in-aws-ec2-using-levo-satellite-ami",level:2},{value:"1. Open the EC2 Launch Wizard and select the Levo Satellite AMI",id:"1-open-the-ec2-launch-wizard-and-select-the-levo-satellite-ami",level:3},{value:"2. EC2 Configuration",id:"2-ec2-configuration",level:3},{value:"3. Add User Metadata to the EC2 instance",id:"3-add-user-metadata-to-the-ec2-instance",level:3},{value:"Traffic Mirroring",id:"traffic-mirroring",level:4},{value:"4. Launch the EC2 instance",id:"4-launch-the-ec2-instance",level:3},{value:"5. Verify the Satellite services",id:"5-verify-the-satellite-services",level:3},{value:"6. Verify connectivity with Levo.ai",id:"6-verify-connectivity-with-levoai",level:3},{value:"a. Check Satellite health",id:"a-check-satellite-health-2",level:4},{value:"b. Check connectivity",id:"b-check-connectivity-2",level:4},{value:"7. Note down <code>Host:Port</code> information",id:"7-note-down-hostport-information",level:3},{value:"Install in AWS EKS",id:"install-in-aws-eks",level:2},{value:"Prerequisites",id:"prerequisites-2",level:3},{value:"Install in AWS EKS using EC2",id:"install-in-aws-eks-using-ec2",level:2},{value:"1. Setup environment variables",id:"1-setup-environment-variables-1",level:3},{value:"2. Cluster Creation",id:"2-cluster-creation",level:3},{value:"3. Connecting to the cluster",id:"3-connecting-to-the-cluster",level:3},{value:"Adding individuals to the cluster",id:"adding-individuals-to-the-cluster",level:4},{value:"Giving access to an IAM User Group",id:"giving-access-to-an-iam-user-group",level:4},{value:"4. Setting the cluster up",id:"4-setting-the-cluster-up",level:3},{value:"Creating an OIDC provider",id:"creating-an-oidc-provider",level:4},{value:"5. Install the satellite",id:"5-install-the-satellite",level:3},{value:"Install in AWS EKS using Fargate",id:"install-in-aws-eks-using-fargate",level:2},{value:"1. Setup environment variables",id:"1-setup-environment-variables-2",level:3},{value:"2. Cluster creation",id:"2-cluster-creation-1",level:3},{value:"3. Connecting to the cluster",id:"3-connecting-to-the-cluster-1",level:3},{value:"Adding individuals to the cluster",id:"adding-individuals-to-the-cluster-1",level:4},{value:"Giving access to an IAM User Group",id:"giving-access-to-an-iam-user-group-1",level:4},{value:"4. Install the satellite",id:"4-install-the-satellite",level:3},{value:"Install in AWS ECS",id:"install-in-aws-ecs",level:2},{value:"Prerequisites",id:"prerequisites-3",level:3},{value:"1. Creating a Task Definition",id:"1-creating-a-task-definition",level:3},{value:"2. Run the Satellite",id:"2-run-the-satellite",level:3},{value:"3. Note down <code>Host:Port</code> information",id:"3-note-down-hostport-information",level:3}];function h(){return(0,i.kt)(o.Z,{fallback:(0,i.kt)("div",null,"Loading..."),mdxType:"BrowserOnly"},(function(){return(0,i.kt)("a",{href:window.location.protocol+"//"+window.location.host+"/artifacts/satellite/docker-compose.yml",download:!0}," Download")}))}var m=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",t)}},k=m("Tabs"),g=m("TabItem"),v={toc:d,DownloadDockerComposeLink:h};function f(e){var t=e.components,n=(0,l.Z)(e,s);return(0,i.kt)("wrapper",(0,a.Z)({},v,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"install-satellite"},"Install Satellite"),(0,i.kt)("h2",{id:"1-prerequisites"},"1. Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"You have an account on ",(0,i.kt)("a",{parentName:"li",href:"https://app.levo.ai/login"},"Levo.ai")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/api-observability/install-guide/os-compat-check"},"OS Compatibility script")," indicates the Linux host (that you want to instrument with the Sensor) is compatible."),(0,i.kt)("li",{parentName:"ul"},"At least 4 CPUs"),(0,i.kt)("li",{parentName:"ul"},"At least 8 GB RAM"),(0,i.kt)("li",{parentName:"ul"},"The Satellite URL should be reachable from the Sensor.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"The Collector listens for spans from the eBPF Sensor on port 4317 using HTTP/2 (gRPC), and port 4318 using HTTP/1.1. "),(0,i.kt)("li",{parentName:"ul"},"The Satellite listens for spans from the PCAP Sensor on port 9999 using HTTP/1.1.")))),(0,i.kt)("h2",{id:"2-copy-authorization-key-from-levoai"},"2. Copy ",(0,i.kt)("inlineCode",{parentName:"h2"},"Authorization Key")," from Levo.ai"),(0,i.kt)("p",null,"The Satellite uses an authorization key to access Levo.ai."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://app.levo.ai/login"},"Login")," to Levo.ai."),(0,i.kt)("li",{parentName:"ul"},"Click on your user profile."),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("inlineCode",{parentName:"li"},"User Settings")),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("inlineCode",{parentName:"li"},"Keys")," on the left navigation panel"),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("inlineCode",{parentName:"li"},"Get Satellite Authorization Key"))),(0,i.kt)("p",null,"Copy your authorization key. This key is required in subsequent steps below."),(0,i.kt)("h2",{id:"3-follow-instructions-for-your-platform"},"3. Follow instructions for your platform"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#install-on-kubernetes"},"Install on Kubernetes")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#install-on-linux-host-via-docker-compose"},"Install on Linux host via Docker Compose")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#install-in-aws-ec2-using-levo-satellite-ami"},"Install in AWS EC2 using Levo Satellite AMI")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#install-in-aws-eks"},"Install in AWS EKS"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#install-in-aws-eks-using-ec2"},"Install in AWS EKS using EC2")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#install-in-aws-eks-using-fargate"},"Install in AWS EKS using Fargate")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#install-in-aws-ecs"},"Install in AWS ECS"))),(0,i.kt)("br",null),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"install-on-kubernetes"},"Install on Kubernetes"),(0,i.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Kubernetes version >= ",(0,i.kt)("inlineCode",{parentName:"li"},"v1.18.0")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://helm.sh/docs/intro/install/"},"Helm v3")," installed and working."),(0,i.kt)("li",{parentName:"ul"},"The Kubernetes cluster API endpoint should be reachable from the machine you are running Helm."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl")," access to the cluster, with ",(0,i.kt)("inlineCode",{parentName:"li"},"cluster-admin")," permissions."),(0,i.kt)("li",{parentName:"ul"},"At least 4 CPUs"),(0,i.kt)("li",{parentName:"ul"},"At least 8 GB RAM")),(0,i.kt)("h3",{id:"1-setup-environment-variables"},"1. Setup environment variables"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"export LEVOAI_AUTH_KEY=<'Authorization Key' copied earlier> \n")),(0,i.kt)("h3",{id:"2-install-levoai-helm-repo"},"2. Install levoai Helm repo"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"helm repo add levoai https://charts.levo.ai && helm repo update\n")),(0,i.kt)("h3",{id:"3-create-levoai-namespace--install-satellite"},"3. Create ",(0,i.kt)("inlineCode",{parentName:"h3"},"levoai")," namespace & install Satellite"),(0,i.kt)("h4",{id:"if-locating-satellite-on-the-same-cluster-alongside-sensor"},"If locating Satellite on the same cluster alongside Sensor"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"helm upgrade --install -n levoai --create-namespace \\\n  --set global.levoai_config_override.onprem-api.refresh-token=$LEVOAI_AUTH_KEY \\\n  levoai-satellite levoai/levoai-satellite\n")),(0,i.kt)("h4",{id:"if-locating-satellite-on-a-dedicated-cluster"},"If locating Satellite on a dedicated cluster"),(0,i.kt)("p",null,"You will need to expose the Satellite via either a ",(0,i.kt)("inlineCode",{parentName:"p"},"LoadBalancer")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"NodePort"),", such that is is reachable by Sensors running in other clusters. Please modify the below command appropriately."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# Please modify this command template and choose either 'LoadBalancer' or 'NodePort', prior to execution\nhelm upgrade --install -n levoai --create-namespace \\\n    --set global.levoai_config_override.onprem-api.refresh-token=$LEVOAI_AUTH_KEY \\\n    --set levoai-collector.service.type=<LoadBalancer | NodePort> \\\n    levoai-satellite levoai/levoai-satellite\n")),(0,i.kt)("h3",{id:"4-verify-connectivity-with-levoai"},"4. Verify connectivity with Levo.ai"),(0,i.kt)("h4",{id:"a-check-satellite-health"},"a. Check Satellite health"),(0,i.kt)("p",null,"The Satellite is comprised of five sub components 1) levoai-collector, 2) levoai-ion, 3) levoai-rabbitmq, 4)levoai-satellite, and 5) levoai-tagger."),(0,i.kt)("p",null,"Wait couple of minutes after the install, and check the health of the components by executing the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl -n levoai get pods\n")),(0,i.kt)("p",null,"If the Satellite is healthy, you should see output similar to below."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"NAME                                READY   STATUS    RESTARTS   AGE\nlevoai-collector-5b54df8dd6-55hq9   1/1     Running   0          5m0s\nlevoai-ion-669c9c4fbc-vsmmr         1/1     Running   0          5m0s\nlevoai-rabbitmq-0                   1/1     Running   0          5m0s\nlevoai-satellite-8688b67c65-xppbn   1/1     Running   0          5m0s\nlevoai-tagger-7bbf565b47-b572w      1/1     Running   0          5m0s\n")),(0,i.kt)("h4",{id:"b-check-connectivity"},"b. Check connectivity"),(0,i.kt)("p",null,"Execute the following to check for connectivity health:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'# Please specify the actual pod name for levoai-tagger below\nkubectl -n levoai logs <levoai-tagger pod name> | grep "Ready to process; waiting for messages."\n')),(0,i.kt)("p",null,"If connectivity is healthy, you will see output similar to below."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'{"level": "info", "time": "2022-06-07 08:07:22,439", "line": "rabbitmq_client.py:155", "version": "fc628b50354bf94e544eef46751d44945a2c55bc", "module": "/opt/levoai/e7s/src/python/levoai_e7s/satellite/rabbitmq_client.py", "message": "Ready to process; waiting for messages."}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Please contact ",(0,i.kt)("inlineCode",{parentName:"strong"},"support@levo.ai")," if you notice health/connectivity related errors.")),(0,i.kt)("h3",{id:"5-note-down-hostport-information"},"5. Note down ",(0,i.kt)("inlineCode",{parentName:"h3"},"Host:Port")," information"),(0,i.kt)("h4",{id:"if-locating-satellite-on-the-same-cluster-alongside-sensor-1"},"If locating Satellite on the same cluster alongside Sensor"),(0,i.kt)("p",null,"The Collector can now be reached by the Sensors running in the same cluster at ",(0,i.kt)("inlineCode",{parentName:"p"},"levoai-collector.levoai:4317"),". Please note this, as it will be required to configure the Sensor."),(0,i.kt)("h4",{id:"if-locating-satellite-on-a-dedicated-cluster-1"},"If locating Satellite on a dedicated cluster"),(0,i.kt)("p",null,"Run the below command and note the ",(0,i.kt)("inlineCode",{parentName:"p"},"external")," address/port of the the Collector service. This will be required to configure the Sensor."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get service levoai-collector -n levoai\n")),(0,i.kt)("p",null,"Please proceed to install the Sensor."),(0,i.kt)("br",null),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"install-on-linux-host-via-docker-compose"},"Install on Linux host via Docker Compose"),(0,i.kt)("h3",{id:"prerequisites-1"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Docker Engine version ",(0,i.kt)("inlineCode",{parentName:"li"},"18.03.0")," and above"),(0,i.kt)("li",{parentName:"ul"},"Admin privileges on the Docker host"),(0,i.kt)("li",{parentName:"ul"},"'docker-compose' installed, if 'docker compose' is not supported on your OS"),(0,i.kt)("li",{parentName:"ul"},"At least 4 CPUs"),(0,i.kt)("li",{parentName:"ul"},"At least 8 GB RAM")),(0,i.kt)("h3",{id:"1-download-docker-compose-file"},"1. Download Docker Compose file"),(0,i.kt)("p",null,"Levo provides pre-built Docker images for the Satellite that can be installed via Docker Compose."),(0,i.kt)(h,{mdxType:"DownloadDockerComposeLink"})," the Docker Compose file to your desktop.",(0,i.kt)("h3",{id:"2-install-satellite"},"2. Install Satellite"),(0,i.kt)("p",null,"Execute the following from the directory where the Docker Compose file was downloaded."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"(export LEVOAI_AUTH_KEY=<'Authorization Key' copied earlier>; docker compose pull && docker compose up -d)\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"If ",(0,i.kt)("inlineCode",{parentName:"p"},"docker compose ...")," complains with ",(0,i.kt)("em",{parentName:"p"},"\"docker: 'compose' is not a docker command.\""),", you have can try ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"docker-compose"))," instead.")),(0,i.kt)("h3",{id:"3-verify-connectivity-with-levoai"},"3. Verify connectivity with Levo.ai"),(0,i.kt)("h4",{id:"a-check-satellite-health-1"},"a. Check Satellite health"),(0,i.kt)("p",null,"The Satellite is comprised of four sub components 1) levoai-collector, 2) levoai-rabbitmq, 3)levoai-satellite, and 4) levoai-tagger."),(0,i.kt)("p",null,"Wait couple of minutes after the install, and check the health of the components by executing the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker ps -f name=levoai\n")),(0,i.kt)("p",null,"If the Satellite is healthy, you should see output similar to below."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'CONTAINER ID   IMAGE                     COMMAND                  CREATED             STATUS                  PORTS                                                                                                                                    NAMES\n2b32cd6b9ced   levoai/collector:stable   "/usr/local/bin/levo\u2026"   10 seconds ago      Up 8 seconds            0.0.0.0:4317->4317/tcp, 9411/tcp                                                                                                         levoai-collector\n06f3c597cad0   levoai/satellite:stable   "gunicorn --capture-\u2026"   10 seconds ago      Up 9 seconds            0.0.0.0:9999->9999/tcp                                                                                                                   levoai-satellite\n89026034c567   levoai/satellite:stable   "python -OO /opt/lev\u2026"   10 seconds ago      Up Less than a second                                                                                                                                            levoai-tagger\nf74524d02fbd   bitnami/rabbitmq:3.10     "/opt/bitnami/script\u2026"   10 seconds ago      Up 9 seconds            5551-5552/tcp, 0.0.0.0:4369->4369/tcp, 5671/tcp, 0.0.0.0:5672->5672/tcp, 0.0.0.0:15672->15672/tcp, 0.0.0.0:25672->25672/tcp, 15671/tcp   levoai-rabbitmq\n')),(0,i.kt)("h4",{id:"b-check-connectivity-1"},"b. Check connectivity"),(0,i.kt)("p",null,"Execute the following to check for connectivity health:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'docker logs levoai-tagger | grep "Ready to process; waiting for messages." \n')),(0,i.kt)("p",null,"If connectivity is healthy, you will see output similar to below."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'{"level": "info", "time": "2022-06-07 08:07:22,439", "line": "rabbitmq_client.py:155", "version": "fc628b50354bf94e544eef46751d44945a2c55bc", "module": "/opt/levoai/e7s/src/python/levoai_e7s/satellite/rabbitmq_client.py", "message": "Ready to process; waiting for messages."}\n')),(0,i.kt)("h3",{id:"4-note-down-hostport-information"},"4. Note down ",(0,i.kt)("inlineCode",{parentName:"h3"},"Host:Port")," information"),(0,i.kt)("p",null,"The Collector now runs in a container, and is reachable on the host via port 4317 (on all the host's network interfaces)."),(0,i.kt)("p",null,"Please note down the either the host's IP address or domain name. The Sensor will be configured to communicate with the Collector at <Host's IP|Domain-Name>:4317."),(0,i.kt)("p",null,"Please proceed to install the Sensor."),(0,i.kt)("br",null),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"install-in-aws-ec2-using-levo-satellite-ami"},"Install in AWS EC2 using Levo Satellite AMI"),(0,i.kt)("h3",{id:"1-open-the-ec2-launch-wizard-and-select-the-levo-satellite-ami"},"1. Open the EC2 Launch Wizard and select the Levo Satellite AMI"),(0,i.kt)("p",null,"Levo provides pre-built AMIs for Satellite. You can launch an EC2 instance using the AMI in the AWS region you wish to install the satellite in."),(0,i.kt)(k,{groupId:"satellite-ami",mdxType:"Tabs"},(0,i.kt)(g,{value:"mac",label:"Mac OSX",mdxType:"TabItem"},(0,i.kt)("ul",null,(0,i.kt)("li",null," ",(0,i.kt)("a",{href:"https://us-west-2.console.aws.amazon.com/ec2/home?region=us-west-1#LaunchInstances:ami=ami-0080f67c406a8e836;instanceType=c6a.xlarge"},"us-west-1 (N. California)")," "),(0,i.kt)("li",null," ",(0,i.kt)("a",{href:"https://us-west-2.console.aws.amazon.com/ec2/home?region=us-west-2#LaunchInstances:ami=ami-09cc59369bf39272b;instanceType=c6a.xlarge"},"us-west-2 (Oregon)")," "),(0,i.kt)("li",null," ",(0,i.kt)("a",{href:"https://us-west-2.console.aws.amazon.com/ec2/home?region=us-east-1#LaunchInstances:ami=ami-03cf724298d12783b;instanceType=c6a.xlarge"},"us-east-1 (N. Virginia)")," "),(0,i.kt)("li",null," ",(0,i.kt)("a",{href:"https://us-west-2.console.aws.amazon.com/ec2/home?region=us-east-2#LaunchInstances:ami=ami-04df19b9035976a79;instanceType=c6a.xlarge"},"us-east-2 (Ohio)")," "),(0,i.kt)("li",null," ",(0,i.kt)("a",{href:"https://us-west-2.console.aws.amazon.com/ec2/home?region=ap-south-1#LaunchInstances:ami=ami-03effa71398878b37;instanceType=c6a.xlarge"},"ap-south-1 (Mumbai)")," "),(0,i.kt)("li",null," ",(0,i.kt)("a",{href:"https://us-west-2.console.aws.amazon.com/ec2/home?region=ap-southeast-1#LaunchInstances:ami=ami-006844540d965f519;instanceType=c6a.xlarge"},"ap-southeast-1 (Singapore)")," "),(0,i.kt)("li",null," ",(0,i.kt)("a",{href:"https://us-west-2.console.aws.amazon.com/ec2/home?region=eu-west-2#LaunchInstances:ami=ami-0e0418c44c42c3b56;instanceType=c6a.xlarge"},"eu-west-2 (London)")," ")))),(0,i.kt)("h3",{id:"2-ec2-configuration"},"2. EC2 Configuration"),(0,i.kt)("p",null,"Pick the following appropriately for your instance. Make sure that this instance is reachable from the eBPF sensors running in your VPC."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Instance Name & tags"),(0,i.kt)("li",{parentName:"ol"},"Key pair"),(0,i.kt)("li",{parentName:"ol"},"The security group",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Make sure to add rules to allow https traffic."),(0,i.kt)("li",{parentName:"ul"},"Allow UDP port 4789 if you are using traffic mirroring."))),(0,i.kt)("li",{parentName:"ol"},"Disk storage. Choose at least 40GB")),(0,i.kt)("h3",{id:"3-add-user-metadata-to-the-ec2-instance"},"3. Add User Metadata to the EC2 instance"),(0,i.kt)("p",null,"Under Advanced details > User Data, add the following (pick the appropriate value of ",(0,i.kt)("inlineCode",{parentName:"p"},"levo_auth_key"),"):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'#!/bin/bash\necho "LEVOAI_AUTH_KEY=xxx" > /opt/levoai/.levoenv\nsudo /opt/levoai/levo_satellite.sh start >> satellite-start.log 2>&1\n# Uncomment the following line to enable the traffic mirroring listener\n# sudo /opt/levoai/levo_traffic_listener.sh start >> traffic-listener-start.log 2>&1\n')),(0,i.kt)("h4",{id:"traffic-mirroring"},"Traffic Mirroring"),(0,i.kt)("p",null,"In order to use traffic mirroring setup uncomment the last line of the user data script.\nCheck ",(0,i.kt)("a",{parentName:"p",href:"/api-observability/install-guide/install-sensor/aws-traffic-mirroring"},"AWS Traffic Mirroring")," for configuring traffic mirroring using Levo CLI."),(0,i.kt)("h3",{id:"4-launch-the-ec2-instance"},"4. Launch the EC2 instance"),(0,i.kt)("p",null,"Satellite services should start automatically once the EC2 instance is initialized"),(0,i.kt)("h3",{id:"5-verify-the-satellite-services"},"5. Verify the Satellite services"),(0,i.kt)("p",null,"To check logs, debug and manage the Satellite services, you can SSH into the VM and use the following commands."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Stop the Satellite: ",(0,i.kt)("inlineCode",{parentName:"li"},"sudo /opt/levo/levo_satellite.sh stop")),(0,i.kt)("li",{parentName:"ol"},"Start the Satellite: ",(0,i.kt)("inlineCode",{parentName:"li"},"sudo /opt/levo/levo_satellite.sh start")),(0,i.kt)("li",{parentName:"ol"},"Upgrade the Satellite: ",(0,i.kt)("inlineCode",{parentName:"li"},"sudo /opt/levo/levo_satellite.sh upgrade")),(0,i.kt)("li",{parentName:"ol"},"Check the services: ",(0,i.kt)("inlineCode",{parentName:"li"},"sudo docker ps"))),(0,i.kt)("h3",{id:"6-verify-connectivity-with-levoai"},"6. Verify connectivity with Levo.ai"),(0,i.kt)("h4",{id:"a-check-satellite-health-2"},"a. Check Satellite health"),(0,i.kt)("p",null,"The Satellite is comprised of four sub components 1) levoai-collector, 2) levoai-rabbitmq, 3)levoai-satellite, and 4) levoai-tagger."),(0,i.kt)("p",null,"Wait couple of minutes after the install, and check the health of the components by executing the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo docker ps -f name=levoai\n")),(0,i.kt)("p",null,"If the Satellite is healthy, you should see output similar to below."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'CONTAINER ID   IMAGE                     COMMAND                  CREATED             STATUS                  PORTS                                                                                                                                    NAMES\n2b32cd6b9ced   levoai/collector:stable   "/usr/local/bin/levo\u2026"   10 seconds ago      Up 8 seconds            0.0.0.0:4317->4317/tcp, 9411/tcp                                                                                                         levoai-collector\n06f3c597cad0   levoai/satellite:stable   "gunicorn --capture-\u2026"   10 seconds ago      Up 9 seconds            0.0.0.0:9999->9999/tcp                                                                                                                   levoai-satellite\n89026034c567   levoai/satellite:stable   "python -OO /opt/lev\u2026"   10 seconds ago      Up Less than a second                                                                                                                                            levoai-tagger\nf74524d02fbd   bitnami/rabbitmq:3.10     "/opt/bitnami/script\u2026"   10 seconds ago      Up 9 seconds            5551-5552/tcp, 0.0.0.0:4369->4369/tcp, 5671/tcp, 0.0.0.0:5672->5672/tcp, 0.0.0.0:15672->15672/tcp, 0.0.0.0:25672->25672/tcp, 15671/tcp   levoai-rabbitmq\n')),(0,i.kt)("h4",{id:"b-check-connectivity-2"},"b. Check connectivity"),(0,i.kt)("p",null,"Execute the following to check for connectivity health:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'sudo docker logs levoai-tagger  2>&1 | grep "Ready to process; waiting for messages."\n')),(0,i.kt)("p",null,"If connectivity is healthy, you will see output similar to below."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'{"level": "info", "time": "2022-06-07 08:07:22,439", "line": "rabbitmq_client.py:155", "version": "fc628b50354bf94e544eef46751d44945a2c55bc", "module": "/opt/levoai/e7s/src/python/levoai_e7s/satellite/rabbitmq_client.py", "message": "Ready to process; waiting for messages."}\n')),(0,i.kt)("h3",{id:"7-note-down-hostport-information"},"7. Note down ",(0,i.kt)("inlineCode",{parentName:"h3"},"Host:Port")," information"),(0,i.kt)("p",null,"The Collector now runs in a container, and is reachable on the host via port 4317 (on all the host's network interfaces)."),(0,i.kt)("p",null,"Please note down the either the host's IP address or domain name. The Sensor will be configured to communicate with the Collector at <Host's IP|Domain-Name>:4317."),(0,i.kt)("p",null,"Please proceed to install the Sensor."),(0,i.kt)("br",null),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"install-in-aws-eks"},"Install in AWS EKS"),(0,i.kt)("p",null,"AWS EKS supports two compute types for its nodes, EC2 and Fargate. Depending on your usecase, you can follow the installation steps given below."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#install-in-aws-eks-using-ec2"},"Install using EC2")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#install-in-aws-eks-using-fargate"},"Install using Fargate"))),(0,i.kt)("h3",{id:"prerequisites-2"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://eksctl.io/"},"eksctl")," version >= ",(0,i.kt)("inlineCode",{parentName:"li"},"v0.152.0")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://helm.sh/docs/intro/install/"},"Helm v3")," installed and working on your local machine."),(0,i.kt)("li",{parentName:"ul"},"An AWS account with EKS permissions.")),(0,i.kt)("h2",{id:"install-in-aws-eks-using-ec2"},"Install in AWS EKS using EC2"),(0,i.kt)("h3",{id:"1-setup-environment-variables-1"},"1. Setup environment variables"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"export LEVOAI_AUTH_KEY=<'Authorization Key' copied earlier> \nexport CLUSTER_NAME=<INSERT CLUSTER NAME>\nexport REGION=<INSERT AWS REGION>\nexport ACCOUNT_ID=<INSERT AWS ACCOUNT ID>\n")),(0,i.kt)("h3",{id:"2-cluster-creation"},"2. Cluster Creation"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"read -r -d '' EKS_CLUSTER <<EOF\napiVersion: eksctl.io/v1alpha5\nkind: ClusterConfig\n\nmetadata:\n  name: ${CLUSTER_NAME}\n  region: ${REGION}\n\nvpc:\n  subnets:\n    private:\n      # MENTION THE SUBNETS YOU WANT TO USE FOR YOUR SATELLITE\n      # FOR EXAMPLE:\n      # us-west-2a: { id: subnet-0d09e999a579234ea }\n      # us-west-2b: { id: subnet-0d09e999a579234eb }\n\nnodeGroups:\n  - name: ng-e2e\n    instanceType: t2.xlarge\n    desiredCapacity: 1\n    volumeSize: 40\n    privateNetworking: true\nEOF\n\necho \"${EKS_CLUSTER}\" > eks-cluster.yaml\n\neksctl create cluster -f ./configuration/eks-cluster.yaml\n")),(0,i.kt)("h3",{id:"3-connecting-to-the-cluster"},"3. Connecting to the cluster"),(0,i.kt)("p",null,"AWS EKS grants cluster admin permissions to the account from which the cluster is created. If you don't need access to the cluster for other AWS Users, you can skip this section."),(0,i.kt)("p",null,"Access to other AWS users in the same account can be granted via 2 ways."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#adding-individuals-to-the-cluster"},"Adding individual access to user accounts")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#giving-access-to-an-iam-user-group"},"Giving the permissions to a user group"))),(0,i.kt)("h4",{id:"adding-individuals-to-the-cluster"},"Adding individuals to the cluster"),(0,i.kt)("p",null,"This command can be run to add an inidividual user account to the cluster's aws-auth configmap"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"eksctl create iamidentitymapping \\\n    --cluster ${CLUSTER_NAME} \\\n    --region ${REGION} \\\n    --arn <AWS ACCOUNT ARN FOR THE USER> \\\n    --group system:masters \\\n    --no-duplicate-arns \\\n    --username <AWS USERNAME FOR THE USER>\n")),(0,i.kt)("h4",{id:"giving-access-to-an-iam-user-group"},"Giving access to an IAM User Group"),(0,i.kt)("p",null,"We create a role developer.assume-access.role and attach two policies to it. The first one is ",(0,i.kt)("inlineCode",{parentName:"p"},"EKSFullAccess")," so that it has access to all the EKS resources. The second one is ",(0,i.kt)("inlineCode",{parentName:"p"},"developer.assume-eks-access-role.policy")," that allows assuming the role."),(0,i.kt)("p",null,"A detailed guide on defining the roles and policies can be found ",(0,i.kt)("a",{parentName:"p",href:"https://eng.grip.security/enabling-aws-iam-group-access-to-an-eks-cluster-using-rbac"},"here"),"."),(0,i.kt)("p",null,"Once you have followed the above guide to create the roles and attach the specific policies, you can add the role to the cluster's aws-auth config map to let the developers group access the cluster"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"eksctl create iamidentitymapping \\\n    --cluster ${CLUSTER_NAME} \\\n    --region ${REGION} \\\n    --arn arn:aws:iam::${ACCOUND_ID}:role/developer.assume-access.role \\\n    --group system:masters \\\n")),(0,i.kt)("p",null,"This needs to be run in order to grant access to the cluster."),(0,i.kt)("p",null,"One can Connect to the cluster by running just a single command"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"aws eks update-kubeconfig --name ${CLUSTER_NAME} --region ${REGION}> --role-arn arn:aws:iam::${ACCOUNT_ID}:role/developer.assume-access.role\n")),(0,i.kt)("p",null,"This commands updates the kubeconfig and adds the context for the cluster and sets the current context to it.\nThe ",(0,i.kt)("inlineCode",{parentName:"p"},"--role")," argument sets the correct role and policies so that seemless access to the cluster is granted instantly."),(0,i.kt)("h3",{id:"4-setting-the-cluster-up"},"4. Setting the cluster up"),(0,i.kt)("h4",{id:"creating-an-oidc-provider"},"Creating an OIDC provider"),(0,i.kt)("p",null,"Run these two commands:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"oidc_id=$(aws eks describe-cluster --name ${CLUSTER_NAME} --region ${REGION} --query \"cluster.identity.oidc.issuer\" --output text | cut -d '/' -f 5)\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'aws iam list-open-id-connect-providers | grep $oidc_id | cut -d "/" -f4 | cut -d "\\"" -f1\n')),(0,i.kt)("p",null,"If this returns a value, that is the OIDC ID that we need. If the statement returns nothing, run this command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"eksctl utils associate-iam-oidc-provider --cluster ${CLUSTER_NAME} --region ${REGION} --approve\n")),(0,i.kt)("p",null,"This creates an OIDC Identity Provider."),(0,i.kt)("p",null,"Next, to create a role in AWS for the EBS CSI Driver add-on (",(0,i.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html"},"Amazon Elastic Block Store CSI Driver")," manages persistent volumes in EKS) we need to run these:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'OIDC=$(aws iam list-open-id-connect-providers | grep $oidc_id | cut -d "/" -f4 | cut -d "\\"" -f1)\n\nread -r -d \'\' EBS_DRIVER_POLICY <<EOF\n{\n"Version": "2012-10-17",\n"Statement": [\n    {\n    "Sid": "",\n    "Effect": "Allow",\n    "Principal": {\n        "Federated": "arn:aws:iam::${ACCOUNT_ID}:oidc-provider/oidc.eks.${REGION}.amazonaws.com/id/${OIDC}"\n    },\n    "Action": "sts:AssumeRoleWithWebIdentity",\n    "Condition": {\n        "StringEquals": {\n        "oidc.eks.${REGION}.amazonaws.com/id/${OIDC}:aud": "sts.amazonaws.com",\n        "oidc.eks.${REGION}.amazonaws.com/id/${OIDC}:sub": "system:serviceaccount:kube-system:ebs-csi-controller-sa"\n        }\n    }\n    }\n]\n}\nEOF\necho "${EBS_DRIVER_POLICY}" > aws-ebs-csi-driver-trust-policy.json\n\naws iam create-role \\\n  --role-name AmazonEKS_EBS_CSI_DriverRole \\\n  --assume-role-policy-document file://aws-ebs-csi-driver-trust-policy.json\n\naws iam attach-role-policy \\\n  --policy-arn arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy \\\n  --role-name AmazonEKS_EBS_CSI_DriverRole\n\neksctl create addon --name aws-ebs-csi-driver --cluster ${CLUSTER_NAME} --region ${REGION} --service-account-role-arn arn:aws:iam::${ACCOUNT_ID}:role/AmazonEKS_EBS_CSI_DriverRole \u2014force\n')),(0,i.kt)("h3",{id:"5-install-the-satellite"},"5. Install the satellite"),(0,i.kt)("p",null,"Please follow the instructions in the ",(0,i.kt)("a",{parentName:"p",href:"#install-on-kubernetes"},"Install on Kubernetes")," section to install the Satellite."),(0,i.kt)("p",null,"Please ensure that you note down the address of the collector."),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"install-in-aws-eks-using-fargate"},"Install in AWS EKS using Fargate"),(0,i.kt)("p",null,"Fargate allows us to have containers without the overhead of managing and scaling servers and clusters. AWS handles the maintenance, as well as security and health of the instances for us, which is something we would not want to spend time into."),(0,i.kt)("h3",{id:"1-setup-environment-variables-2"},"1. Setup environment variables"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"export LEVOAI_AUTH_KEY=<'Authorization Key' copied earlier> \nCLUSTER_NAME=< INSERT CLUSTER NAME >\nREGION=< INSERT AWS REGION >\nACCOUNT_ID=<INSERT AWS ACCOUNT ID>\n")),(0,i.kt)("h3",{id:"2-cluster-creation-1"},"2. Cluster creation"),(0,i.kt)("p",null,"To create a cluster using Fargate, run"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"eksctl create cluster --name ${CLUSTER_NAME} --region ${REGION} --fargate \n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"--fargate")," specifies that the cluster needs to run on fargate, and initially assigns 2 fargate nodes to us "),(0,i.kt)("p",null,"It can be checked by running ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl get nodes")," . The output would be something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"fargate-ip-192.168.1.1.<aws-region>.compute.internal   Ready    <none>   1m   v1.25\nfargate-ip-192-168-1.1.<aws-region>.compute.internal   Ready    <none>   1m   v1.25\n")),(0,i.kt)("h3",{id:"3-connecting-to-the-cluster-1"},"3. Connecting to the cluster"),(0,i.kt)("p",null,"AWS EKS grants cluster admin permissions to the account from which the cluster is created. If you don't need access to the cluster for other AWS Users, you can skip this section."),(0,i.kt)("p",null,"Access to other AWS users in the same account can be granted via 2 ways."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#adding-individuals-to-the-cluster"},"Adding individual access to user accounts")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#giving-access-to-an-iam-user-group"},"Giving the permissions to a user group"))),(0,i.kt)("h4",{id:"adding-individuals-to-the-cluster-1"},"Adding individuals to the cluster"),(0,i.kt)("p",null,"This command can be run to add an inidividual user account to the cluster's aws-auth configmap"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"eksctl create iamidentitymapping \\\n    --cluster ${CLUSTER_NAME} \\\n    --region ${REGION} \\\n    --arn <AWS ACCOUNT ARN FOR THE USER> \\\n    --group system:masters \\\n    --no-duplicate-arns \\\n    --username <AWS USERNAME FOR THE USER>\n")),(0,i.kt)("h4",{id:"giving-access-to-an-iam-user-group-1"},"Giving access to an IAM User Group"),(0,i.kt)("p",null,"We create a role developer.assume-access.role and attach two policies to it. The first one is ",(0,i.kt)("inlineCode",{parentName:"p"},"EKSFullAccess")," so that it has access to all the EKS resources. The second one is ",(0,i.kt)("inlineCode",{parentName:"p"},"developer.assume-eks-access-role.policy")," that allows assuming the role."),(0,i.kt)("p",null,"A detailed guide on defining the roles and policies can be found ",(0,i.kt)("a",{parentName:"p",href:"https://eng.grip.security/enabling-aws-iam-group-access-to-an-eks-cluster-using-rbac"},"here"),"."),(0,i.kt)("p",null,"Once you have followed the above guide to create the roles and attach the specific policies, you can add the role to the cluster's aws-auth config map to let the developers group access the cluster"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"eksctl create iamidentitymapping \\\n    --cluster ${CLUSTER_NAME} \\\n    --region ${REGION} \\\n    --arn arn:aws:iam::${ACCOUND_ID}:role/developer.assume-access.role \\\n    --group system:masters \\\n")),(0,i.kt)("p",null,"This needs to be run in order to grant access to the cluster."),(0,i.kt)("p",null,"One can Connect to the cluster by running just a single command"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"aws eks update-kubeconfig --name ${CLUSTER_NAME} --region ${REGION}> --role-arn arn:aws:iam::${ACCOUNT_ID}:role/developer.assume-access.role\n")),(0,i.kt)("p",null,"This commands updates the kubeconfig and adds the context for the cluster and sets the current context to it.\nThe ",(0,i.kt)("inlineCode",{parentName:"p"},"--role")," argument sets the correct role and policies so that seemless access to the cluster is granted instantly."),(0,i.kt)("h3",{id:"4-install-the-satellite"},"4. Install the satellite"),(0,i.kt)("p",null,"Please follow the instructions in the ",(0,i.kt)("a",{parentName:"p",href:"#install-on-kubernetes"},"Install on Kubernetes")," section to install the Satellite."),(0,i.kt)("p",null,"Please ensure that you note down the address of the collector."),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"install-in-aws-ecs"},"Install in AWS ECS"),(0,i.kt)("h3",{id:"prerequisites-3"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Access to AWS ECS."),(0,i.kt)("li",{parentName:"ul"},"Levo.ai Org ID. Follow instructions below to copy the org ID.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://app.levo.ai/login"},"Login")," to Levo.ai."),(0,i.kt)("li",{parentName:"ul"},"Click on your user profile."),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("inlineCode",{parentName:"li"},"User Settings")),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("inlineCode",{parentName:"li"},"Organizations")," on the left navigation panel"),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("inlineCode",{parentName:"li"},"Copy")," under ",(0,i.kt)("inlineCode",{parentName:"li"},"Organization ID")))),(0,i.kt)("li",{parentName:"ul"},"An AWS Role with the policies - ",(0,i.kt)("strong",{parentName:"li"},"_")," to assign to the task.")),(0,i.kt)("h3",{id:"1-creating-a-task-definition"},"1. Creating a Task Definition"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Open the AWS ECS console and click on Task Definitions.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Under the Create Task Defintion on the top right, click on ",(0,i.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/ecs/v2/create-task-definition-with-json"},"Create New Task Definition with JSON"),"."),(0,i.kt)("blockquote",{parentName:"li"},(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"NOTE:")),"  Make sure you are in the right AWS region that you want to have your service in"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Use the following task definition."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'{\n    "family": "levoai-satellite",\n    "containerDefinitions": [\n        {\n            "name": "levoai-satellite",\n            "image": "levoai/satellite",\n            "cpu": 0,\n            "portMappings": [\n                {\n                    "name": "levoai-satellite-9999-tcp",\n                    "containerPort": 9999,\n                    "hostPort": 9999,\n                    "protocol": "tcp",\n                    "appProtocol": "http"\n                }\n            ],\n            "essential": true,\n            "command": [\n                "-w",\n                "1",\n                "-b",\n                "0.0.0.0:9999",\n                "--worker-class",\n                "gevent",\n                "--worker-connections",\n                "30",\n                "levoai_e7s.satellite.satellite:create_server()"\n            ],\n            "environment": [\n                {\n                    "name": "LEVOAI_DEBUG_SERVER_HOST",\n                    "value": "host.docker.internal"\n                },\n                {\n                    "name": "LEVOAI_ORG_ID",\n                    "value": "899590a5-0cca-47f3-915d-31e8a0d2386a"\n                },\n                {\n                    "name": "LEVOAI_MODE",\n                    "value": "docker-compose"\n                },\n                {\n                    "name": "LEVOAI_CONF_OVERRIDES",\n                    "value": "{\\"onprem-api\\": {\\"url\\": \\"https://api.levo.ai\\", \\"refresh-token\\": \\"${LEVOAI_AUTH_KEY}\\", \\"org-id\\": \\"${LEVOAI_ORG_ID:-}\\", \\"org-prefix\\": \\"${LEVOAI_ORG_PREFIX:-}\\"},\\"traces_queue\\": {\\"type\\": \\"sqs\\"}}"\n                },\n                {\n                    "name": "LEVOAI_DEBUG_ENABLED",\n                    "value": "false"\n                },\n                {\n                    "name": "LEVOAI_AUTH_KEY",\n                    "value": "< INSERT YOUR LEVO.AI AUTH KEY HERE >"\n                },\n                {\n                    "name": "LEVOAI_LOG_LEVEL",\n                    "value": "INFO"\n                },\n                {\n                    "name": "LEVOAI_DEBUG_PORT",\n                    "value": "12345"\n                }\n            ],\n            "mountPoints": [],\n            "volumesFrom": [],\n            "logConfiguration": {\n                "logDriver": "awslogs",\n                "options": {\n                    "awslogs-create-group": "true",\n                    "awslogs-group": "/ecs/satellite",\n                    "awslogs-region": "< INSERT YOUR AWS REGION HERE >",\n                    "awslogs-stream-prefix": "ecs"\n                }\n            }\n        },\n        {\n            "name": "levoai-tagger",\n            "image": "levoai/satellite",\n            "cpu": 0,\n            "portMappings": [],\n            "essential": true,\n            "entryPoint": [\n                "python",\n                "-OO"\n            ],\n            "command": [\n                "/opt/levoai/e7s/src/python/levoai_e7s/tag_server.py"\n            ],\n            "environment": [\n                {\n                    "name": "LEVOAI_DEBUG_SERVER_HOST",\n                    "value": "host.docker.internal"\n                },\n                {\n                    "name": "LEVOAI_ORG_ID",\n                    "value": "< INSERT YOUR LEVO.AI ORG ID HERE >"\n                },\n                {\n                    "name": "LEVOAI_MODE",\n                    "value": "docker-compose"\n                },\n                {\n                    "name": "LEVOAI_CONF_OVERRIDES",\n                    "value": "{\\"onprem-api\\":{\\"url\\": \\"https://api.levo.ai\\",\\"refresh-token\\":\\"${LEVOAI_AUTH_KEY}\\",\\"org-id\\": \\"${LEVOAI_ORG_ID}\\",\\"org-prefix\\": \\"${LEVOAI_ORG_PREFIX}\\"},\\"url_clusterer_id_len\\": 1,\\"min_urls_required_per_pattern\\": 10,\\"dynamic_url_threshold_factor\\": 0.5,\\"cookie_auth_keys\\": \\"${LEVOAI_COOKIE_AUTH_KEYS:-}\\",\\"disable_ml_detector\\": true,\\"service_naming\\":{\\"strategies\\": \\"KUBERNETES_METADATA,HOST_HEADER,DEFAULT\\"},\\"user_resolvers\\": [],\\"sample_collection\\":{\\"enabled\\": true,\\"max_samples_per_end_point\\": 2,\\"users\\": []},\\"tagger_batch_interval_minute\\": 5,\\"api_rule_evaluation\\":{\\"enabled\\": true},\\"ion\\":{\\"url\\": \\"http://levoai-ion:8000\\"},\\"enable_ssl_cert_checks\\": true,\\"sensitive_data_config\\": [],\\"traces_queue\\":{\\"type\\": \\"sqs\\"}}"\n                },\n                {\n                    "name": "PI_DETECTOR_DATA_DIR",\n                    "value": "/opt/levoai/datasets/"\n                },\n                {\n                    "name": "LEVOAI_DEBUG_ENABLED",\n                    "value": "false"\n                },\n                {\n                    "name": "LEVOAI_AUTH_KEY",\n                    "value": "< INSERT YOUR LEVO.AI AUTH KEY HERE >"\n                },\n                {\n                    "name": "LEVOAI_LOG_LEVEL",\n                    "value": "INFO"\n                },\n                {\n                    "name": "LEVOAI_DEBUG_PORT",\n                    "value": "1234"\n                }\n            ],\n            "mountPoints": [],\n            "volumesFrom": [],\n            "logConfiguration": {\n                "logDriver": "awslogs",\n                "options": {\n                    "awslogs-create-group": "true",\n                    "awslogs-group": "/ecs/satellite",\n                    "awslogs-region": "< INSERT YOUR AWS REGION HERE >",\n                    "awslogs-stream-prefix": "ecs"\n                }\n            }\n        },\n        {\n            "name": "levoai-collector",\n            "image": "levoai/collector",\n            "cpu": 0,\n            "portMappings": [\n                {\n                    "name": "levoai-collector-4317-tcp",\n                    "containerPort": 4317,\n                    "hostPort": 4317,\n                    "protocol": "tcp",\n                    "appProtocol": "http"\n                }\n            ],\n            "essential": true,\n            "environment": [],\n            "mountPoints": [],\n            "volumesFrom": [],\n            "logConfiguration": {\n                "logDriver": "awslogs",\n                "options": {\n                    "awslogs-create-group": "true",\n                    "awslogs-group": "/ecs/satellite",\n                    "awslogs-region": "< INSERT YOUR AWS REGION HERE >",\n                    "awslogs-stream-prefix": "ecs"\n                }\n            }\n        },\n        {\n            "name": "levoai-ion",\n            "image": "levoai/ion",\n            "cpu": 0,\n            "portMappings": [\n                {\n                    "name": "levoai-ion-8000-tcp",\n                    "containerPort": 8000,\n                    "hostPort": 8000,\n                    "protocol": "tcp",\n                    "appProtocol": "http"\n                }\n            ],\n            "essential": false,\n            "environment": [],\n            "mountPoints": [],\n            "volumesFrom": [],\n            "logConfiguration": {\n                "logDriver": "awslogs",\n                "options": {\n                    "awslogs-create-group": "true",\n                    "awslogs-group": "/ecs/satellite",\n                    "awslogs-region": "< INSERT YOUR AWS REGION HERE >",\n                    "awslogs-stream-prefix": "ecs"\n                }\n            }\n        }\n    ],\n    "taskRoleArn": "< INSERT THE ARN OF THE ROLE YOU WANT TO ASSIGN TO THIS TASK HERE >",\n    "executionRoleArn": "< INSERT THE ARN OF THE ROLE YOU WANT TO ASSIGN TO THIS TASK HERE >",\n    "networkMode": "awsvpc",\n    "requiresCompatibilities": [\n        "FARGATE"\n    ],\n    "cpu": "4096",\n    "memory": "8192",\n    "runtimePlatform": {\n        "cpuArchitecture": "X86_64",\n        "operatingSystemFamily": "LINUX"\n    }\n}\n')),(0,i.kt)("h3",{id:"2-run-the-satellite"},"2. Run the Satellite"),(0,i.kt)("p",null,"Now that we have created a task definition, we will start our satellite up as a service in an ECS cluster."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Open the levo-satellite task definition, and click on the latest revision."),(0,i.kt)("li",{parentName:"ul"},"Head over to ",(0,i.kt)("inlineCode",{parentName:"li"},"deploy")," and select ",(0,i.kt)("inlineCode",{parentName:"li"},"Create Service"),"."),(0,i.kt)("li",{parentName:"ul"},"Choose the cluster you want to deploy the satellite."),(0,i.kt)("li",{parentName:"ul"},"Under ",(0,i.kt)("inlineCode",{parentName:"li"},"Compute Options")," select ",(0,i.kt)("inlineCode",{parentName:"li"},"Launch Type"),"."),(0,i.kt)("li",{parentName:"ul"},"Leave the other configurations on default settings, and start the service.")),(0,i.kt)("h3",{id:"3-note-down-hostport-information"},"3. Note down ",(0,i.kt)("inlineCode",{parentName:"h3"},"Host:Port")," information"),(0,i.kt)("p",null,"The collector can be accessed over the internet and its IP can be checked from within the cluster."),(0,i.kt)("p",null,"Head over to the cluster you earlier used to run the satellite on."),(0,i.kt)("p",null,"Click on Tasks and select the particular satellite task."),(0,i.kt)("p",null,"Under the ",(0,i.kt)("inlineCode",{parentName:"p"},"Container details for levoai-collector")," go to ",(0,i.kt)("inlineCode",{parentName:"p"},"Network bindings"),". It should look something like this"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"Network bindings\nHost port       Container port      Protocol        External link\n4317            4317                tcp             52.32.232.165:4317\n")),(0,i.kt)("p",null,"The Collector can now be reached by the Sensors over the internet using this ",(0,i.kt)("inlineCode",{parentName:"p"},"external-link:4317")," (Kindly add inbound rules to the security group being used by this task if you're unable to reach the satellite). Please note this, as it will be required to configure the Sensor."),(0,i.kt)("p",null,"Please proceed to install the Sensor."),(0,i.kt)("br",null),(0,i.kt)("hr",null))}f.isMDXComponent=!0}}]);