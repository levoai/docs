"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5889],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),c=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(o.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,o=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=c(n),h=r,g=d["".concat(o,".").concat(h)]||d[h]||p[h]||s;return n?a.createElement(g,l(l({ref:t},u),{},{components:n})):a.createElement(g,l({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,l=new Array(s);l[0]=d;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var c=2;c<s;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2196:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return o},default:function(){return h},frontMatter:function(){return i},metadata:function(){return c},toc:function(){return p}});var a=n(3117),r=n(102),s=(n(7294),n(3905)),l=["components"],i={sidebar_position:5},o="Satellite on AWS EKS using Fargate",c={unversionedId:"install-satellite/satellite-aws-eks-fargate",id:"install-satellite/satellite-aws-eks-fargate",title:"Satellite on AWS EKS using Fargate",description:"Fargate allows us to have containers without the overhead of managing and scaling servers and clusters. AWS handles the maintenance, as well as security and health of the instances for us, which is something we would not want to spend time into.",source:"@site/docs/install-satellite/satellite-aws-eks-fargate.md",sourceDirName:"install-satellite",slug:"/install-satellite/satellite-aws-eks-fargate",permalink:"/install-satellite/satellite-aws-eks-fargate",draft:!1,editUrl:"https://github.com/levoai/docs/edit/main/docs/install-satellite/satellite-aws-eks-fargate.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Satellite on AWS EKS",permalink:"/install-satellite/satellite-aws-eks"},next:{title:"Satellite on AWS ECS",permalink:"/install-satellite/satellite-aws-ecs"}},u={},p=[{value:"1. Setup environment variables",id:"1-setup-environment-variables",level:3},{value:"2. Cluster creation",id:"2-cluster-creation",level:3},{value:"3. Connecting to the cluster",id:"3-connecting-to-the-cluster",level:3},{value:"Adding individuals to the cluster",id:"adding-individuals-to-the-cluster",level:4},{value:"Giving access to an IAM User Group",id:"giving-access-to-an-iam-user-group",level:4},{value:"4. Install the satellite",id:"4-install-the-satellite",level:3}],d={toc:p};function h(e){var t=e.components,n=(0,r.Z)(e,l);return(0,s.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"satellite-on-aws-eks-using-fargate"},"Satellite on AWS EKS using Fargate"),(0,s.kt)("p",null,"Fargate allows us to have containers without the overhead of managing and scaling servers and clusters. AWS handles the maintenance, as well as security and health of the instances for us, which is something we would not want to spend time into."),(0,s.kt)("h3",{id:"1-setup-environment-variables"},"1. Setup environment variables"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"export CLUSTER_NAME='Cluster Name'\nexport REGION='AWS Region'\nexport ACCOUNT_ID='AWS Account ID'\n")),(0,s.kt)("h3",{id:"2-cluster-creation"},"2. Cluster creation"),(0,s.kt)("p",null,"To create a cluster using Fargate, run"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"eksctl create cluster --name ${CLUSTER_NAME} --region ${REGION} --fargate \n")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"--fargate")," specifies that the cluster needs to run on fargate, and initially assigns 2 fargate nodes to us"),(0,s.kt)("p",null,"It can be checked by running ",(0,s.kt)("inlineCode",{parentName:"p"},"kubectl get nodes")," . The output would be something like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"fargate-ip-192.168.1.1.<aws-region>.compute.internal   Ready    <none>   1m   v1.25\nfargate-ip-192-168-1.1.<aws-region>.compute.internal   Ready    <none>   1m   v1.25\n")),(0,s.kt)("h3",{id:"3-connecting-to-the-cluster"},"3. Connecting to the cluster"),(0,s.kt)("p",null,"AWS EKS grants cluster admin permissions to the account from which the cluster is created. If you don't need access to the cluster for other AWS Users, you can skip this section."),(0,s.kt)("p",null,"Access to other AWS users in the same account can be granted via 2 ways."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#adding-individuals-to-the-cluster"},"Adding individual access to user accounts")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#giving-access-to-an-iam-user-group"},"Giving the permissions to a user group"))),(0,s.kt)("h4",{id:"adding-individuals-to-the-cluster"},"Adding individuals to the cluster"),(0,s.kt)("p",null,"This command can be run to add an inidividual user account to the cluster's aws-auth configmap"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"eksctl create iamidentitymapping \\\n    --cluster ${CLUSTER_NAME} \\\n    --region ${REGION} \\\n    --arn <AWS ACCOUNT ARN FOR THE USER> \\\n    --group system:masters \\\n    --no-duplicate-arns \\\n    --username <AWS USERNAME FOR THE USER>\n")),(0,s.kt)("h4",{id:"giving-access-to-an-iam-user-group"},"Giving access to an IAM User Group"),(0,s.kt)("p",null,"We create a role developer.assume-access.role and attach two policies to it. The first one is ",(0,s.kt)("inlineCode",{parentName:"p"},"EKSFullAccess")," so that it has access to all the EKS resources. The second one is ",(0,s.kt)("inlineCode",{parentName:"p"},"developer.assume-eks-access-role.policy")," that allows assuming the role."),(0,s.kt)("p",null,"A detailed guide on defining the roles and policies can be found ",(0,s.kt)("a",{parentName:"p",href:"https://eng.grip.security/enabling-aws-iam-group-access-to-an-eks-cluster-using-rbac"},"here"),"."),(0,s.kt)("p",null,"Once you have followed the above guide to create the roles and attach the specific policies, you can add the role to the cluster's aws-auth config map to let the developers group access the cluster"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"eksctl create iamidentitymapping \\\n    --cluster ${CLUSTER_NAME} \\\n    --region ${REGION} \\\n    --arn arn:aws:iam::${ACCOUND_ID}:role/developer.assume-access.role \\\n    --group system:masters \\\n")),(0,s.kt)("p",null,"This needs to be run in order to grant access to the cluster."),(0,s.kt)("p",null,"One can Connect to the cluster by running just a single command"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"aws eks update-kubeconfig --name ${CLUSTER_NAME} --region ${REGION}> --role-arn arn:aws:iam::${ACCOUNT_ID}:role/developer.assume-access.role\n")),(0,s.kt)("p",null,"This commands updates the kubeconfig and adds the context for the cluster and sets the current context to it.\nThe ",(0,s.kt)("inlineCode",{parentName:"p"},"--role")," argument sets the correct role and policies so that seemless access to the cluster is granted instantly."),(0,s.kt)("h3",{id:"4-install-the-satellite"},"4. Install the satellite"),(0,s.kt)("p",null,"Please follow the instructions in the ",(0,s.kt)("a",{parentName:"p",href:"/install-satellite/satellite-kubernetes"},"Install on Kubernetes")," section to install the Satellite."),(0,s.kt)("p",null,"Please ensure that you note down the address of the collector."))}h.isMDXComponent=!0}}]);