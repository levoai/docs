##############################################################################################
# eBPF Sensor Configuration Settings (YAML Format)
# Copyright: Levo Inc., 2022
##############################################################################################


# --------------------------------------------------------------------------------------------
# Factory Settings: DO NOT MODIFY
# --------------------------------------------------------------------------------------------
#bpf-object-file: /opt/levo/libexec/levo/ebpf-sensor/bpf_progs.bpf.o
#debug: []
#legacy-kernel-btf-path: ""
#single-threaded-mode: false
#worker-threads: 3 # Defaults to 3, or the number of CPUs in the system, whichever is greater
#metadata-resolution-failure-policy: ignore # policy for handling metadata resolution failures
#trace-client-traffic: false # enable tracing of client-side traffic generated by the host
#trace-non-k8s-traffic: false # enable tracing of non-Kubernetes traffic when deployed within a Kubernetes DaemonSet
# --------------------------------------------------------------------------------------------


# --------------------------------------------------------------------------------------------
# Default Application Name:
# --------------------------------------------------------------------------------------------
# Auto discovered API endpoints and their OpenAPI specifications are show in the API Catalog
# grouped under this application name. The application name helps segregate and group API
# endpoints from different environments.

default-service-name: default
# --------------------------------------------------------------------------------------------


# --------------------------------------------------------------------------------------------
# Satellite Settings:
# --------------------------------------------------------------------------------------------
# host:port for the collector service receiving the Sensor's API traces.

collector-endpoint: localhost:4317
# --------------------------------------------------------------------------------------------

# --------------------------------------------------------------------------------------------
# API Trace Export Rate Limiting:
# --------------------------------------------------------------------------------------------
# By default, the sensor rate-limits the overall number of request-response traces it exports
# to the satellite.  It also rate-limits traces on a per-endpoint basis.  Rate limiting can
# be disabled or adjusted, but doing so may affect the performance of downstream Levo
# services.

# enable-export-rate-limiting: true
# max-total-exported-requests-per-second: 200
# max-per-endpoint-exported-requests-per-second: 20

# --------------------------------------------------------------------------------------------

# --------------------------------------------------------------------------------------------
# Metrics Settings:
# --------------------------------------------------------------------------------------------
# Uncomment and modify to enable the printing of sensor metrics alongside other sensor logging
# messages.

# export-metrics-to-log: false

# --------------------------------------------------------------------------------------------
# Process Filters: process command names/IDs to monitor & capture API traffic.
# --------------------------------------------------------------------------------------------
# Uncomment and modify appropriately to limit capture to specific process names or IDs.
# Both monitored-commands and monitored-pids support list of names & IDs respectively.
# NOTE: monitored-commands and monitored-pids settings are mutually exclusive

#monitored-commands:
#  - <process command name. Example: nginx>
#  - <process command name. Example: python3>

#monitored-pids:
#  - <pid. Example: 123>
#  - <pid. Example: 45>
# --------------------------------------------------------------------------------------------


# --------------------------------------------------------------------------------------------
# IP Filters: IP/Port/Network address based granular filtering of API traffic.
# --------------------------------------------------------------------------------------------
# IP Filters enable granular capture of API traffic based on various criteria.
# Default values ignore traffic from standard ports that normally do not carry HTTP traffic.
# Refer to documentation on how these can be customized to suit your environment.
ip-filter-list:
  default-policy: accept # Default policy is to capture all traffic
  entries: # Specific 'entries' can override the default policy
    ### Host Ports ###
    # Host Port is the server listening port, where client connections are accepted.
    - policy: drop
      host-ports: 53 # DNS
    - policy: drop
      host-ports: 2379-2380 # etcd
    - policy: drop
      host-ports: 9092-9093 # kafka
    - policy: drop
      host-ports: 27017-27019 # mongodb
    - policy: drop
      host-ports: 28017 # mongodb
    - policy: drop
      host-ports: 135 # SQL Server
    - policy: drop
      host-ports: 1433-1434 # SQL Server
    - policy: drop
      host-ports: 4022 # SQL Server
    - policy: drop
      host-ports: 3306 # MySQL
    - policy: drop
      host-ports: 33060-33062 # MySQL
    - policy: drop
      host-ports: 5432-5433 # Postgres
    - policy: drop
      host-ports: 5671-5672 # RabbitMQ
    - policy: drop
      host-ports: 15672-15675 # RabbitMQ
    - policy: drop
      host-ports: 25672 # RabbitMQ
    - policy: drop
      host-ports: 35672-35682 # RabbitMQ
    - policy: drop
      host-ports: 61613-61614 # RabbitMQ
    - policy: drop
      host-ports: 6379 # Redis
    - policy: drop
      host-ports: [2181, 3888, 3888] # ZooKeeper
    - policy: drop
      host-ports: [4317, 9999] # Levo's Satellite services
    ### Peer Ports ###
    # Peer Port is the client port used in communication with the server listening port.
    - policy: drop
      peer-ports: 53 # DNS
    - policy: drop
      peer-ports: 2379-2380 # etcd
    - policy: drop
      peer-ports: 9092-9093 # kafka
    - policy: drop
      peer-ports: 27017-27019 # mongodb
    - policy: drop
      peer-ports: 28017 # mongodb
    - policy: drop
      peer-ports: 135 # SQL Server
    - policy: drop
      peer-ports: 1433-1434 # SQL Server
    - policy: drop
      peer-ports: 4022 # SQL Server
    - policy: drop
      peer-ports: 3306 # MySQL
    - policy: drop
      peer-ports: 33060-33062 # MySQL
    - policy: drop
      peer-ports: 5432-5433 # Postgres
    - policy: drop
      peer-ports: 5671-5672 # RabbitMQ
    - policy: drop
      peer-ports: 15672-15675 # RabbitMQ
    - policy: drop
      peer-ports: 25672 # RabbitMQ
    - policy: drop
      peer-ports: 35672-35682 # RabbitMQ
    - policy: drop
      peer-ports: 61613-61614 # RabbitMQ
    - policy: drop
      peer-ports: 6379 # Redis
    - policy: drop
      peer-ports: [2181, 3888, 3888] # ZooKeeper
    - policy: drop
      peer-ports: [4317, 9999] # Levo's Satellite services
# --------------------------------------------------------------------------------------------


# --------------------------------------------------------------------------------------------
# URL Filters: API parameter based granular filtering of API traffic.
# --------------------------------------------------------------------------------------------
# URL filters allow granular filtering of API traffic based on the 'API endpoint Method' (operation),
# the 'API Host' (Host Header), and the 'API endpoint's URI'.
# Refer to the documentation for instructions on configuring URL filters.
#
# Example: Ignore API endpoints with URI path beginning with '/static/'
#url-filter:
#  default-url-action: trace # Trace all API endpoints by default
#  rules:
#    - action: ignore
#      request-uri: /static/.*
#

# --------------------------------------------------------------------------------------------
